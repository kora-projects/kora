/**
 * NOTE: This class is auto generated by Kora OpenAPI Generator (https://openapi-generator.tech) ({{{generatorVersion}}}).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */
package {{apiPackage}};

import ru.tinkoff.kora.config.common.extractor.ConfigValueExtractor;

import ru.tinkoff.kora.http.client.common.interceptor.*;
import ru.tinkoff.kora.http.common.auth.*;
import ru.tinkoff.kora.http.client.common.auth.*;


@ru.tinkoff.kora.common.annotation.Generated("openapi generator kora client")
@ru.tinkoff.kora.common.Module
public interface ApiSecurity {
{{#authMethods}}

    @ru.tinkoff.kora.common.annotation.Generated("openapi generator kora client")
    static final class {{#lambda.classname}}{{name}}{{/lambda.classname}} {}

{{#isApiKey}}
    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class)
    default String {{name}}Config(ru.tinkoff.kora.config.common.Config config, ConfigValueExtractor<String> extractor) {
        var configPath = "{{#hasSecurityConfigPrefix}}{{securityConfigPrefix}}.{{/hasSecurityConfigPrefix}}{{name}}";
        var configValue = config.get(configPath);
        var parsed = extractor.extract(configValue);
        if (parsed == null) {
            throw ru.tinkoff.kora.config.common.extractor.ConfigValueExtractionException.missingValueAfterParse(configValue);
        }
        return parsed;
    }

    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class)
    default HttpClientInterceptor {{name}}HttpClientAuthInterceptor(@ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class) String apiKey) {
        var paramLocation = ApiKeyHttpClientInterceptor.ApiKeyLocation.{{#isKeyInQuery}}QUERY{{/isKeyInQuery}}{{#isKeyInHeader}}HEADER{{/isKeyInHeader}}{{#isKeyInCookie}}COOKIE{{/isKeyInCookie}};
        return new ApiKeyHttpClientInterceptor(paramLocation, "{{keyParamName}}", apiKey);
    }
{{/isApiKey}}{{#isBasicBasic}}
    @ru.tinkoff.kora.common.annotation.Generated("openapi generator kora client")
    static record {{#lambda.classname}}{{name}}{{/lambda.classname}}Config(String username, String password) {}

    @ru.tinkoff.kora.common.DefaultComponent
    default {{#lambda.classname}}{{name}}{{/lambda.classname}}Config {{name}}Config(ru.tinkoff.kora.config.common.Config config, ConfigValueExtractor<{{#lambda.classname}}{{name}}{{/lambda.classname}}Config> extractor) {
        var configPath = "{{#hasSecurityConfigPrefix}}{{securityConfigPrefix}}.{{/hasSecurityConfigPrefix}}{{name}}";
        var configValue = config.get(configPath);
        var parsed = extractor.extract(configValue);
        if (parsed == null) {
            throw ru.tinkoff.kora.config.common.extractor.ConfigValueExtractionException.missingValueAfterParse(configValue);
        }
        return parsed;
    }

    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class)
    default HttpClientTokenProvider {{name}}BasicAuthHttpClientTokenProvider({{#lambda.classname}}{{name}}{{/lambda.classname}}Config config) {
        return new BasicAuthHttpClientTokenProvider(config.username(), config.password());
    }

    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class)
    default HttpClientInterceptor {{name}}HttpClientAuthInterceptor(@ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class) HttpClientTokenProvider tokenProvider) {
        return new BasicAuthHttpClientInterceptor(tokenProvider);
    }
{{/isBasicBasic}}{{#isBasicBearer}}
    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class)
    default HttpClientInterceptor {{name}}HttpClientAuthInterceptor(@ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class) HttpClientTokenProvider tokenProvider) {
        return new BearerAuthHttpClientInterceptor(tokenProvider);
    }
{{/isBasicBearer}}{{#isOAuth}}
    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class)
    default HttpClientInterceptor {{name}}HttpClientAuthInterceptor(@ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class) HttpClientTokenProvider tokenProvider) {
        return new BearerAuthHttpClientInterceptor(tokenProvider);
    }
{{/isOAuth}}{{/authMethods}} {{#vendorExtensions.authMethodTags}}

    @ru.tinkoff.kora.common.annotation.Generated("openapi generator kora client")
    static final class {{.}} {}
{{/vendorExtensions.authMethodTags}}
{{#vendorExtensions.authMethods}}

    @ru.tinkoff.kora.common.DefaultComponent
    @ru.tinkoff.kora.common.Tag({{name}}.class)
    default HttpClientInterceptor {{name}}HttpClientAuthInterceptor({{#methods}}
        @ru.tinkoff.kora.common.Tag(ApiSecurity.{{#lambda.classname}}{{name}}{{/lambda.classname}}.class) HttpClientInterceptor {{#lambda.camelcase}}{{name}}{{/lambda.camelcase}}{{^vendorExtensions.isLast}},{{/vendorExtensions.isLast}}{{/methods}}) {
            return (ctx, chain, request) -> {{#methods}}{{#vendorExtensions.isFirst}}
                    {{#lambda.camelcase}}{{name}}{{/lambda.camelcase}}.processRequest(ctx, {{/vendorExtensions.isFirst}}{{^vendorExtensions.isFirst}}
                        (ctx{{vendorExtensions.index}}, request{{vendorExtensions.index}}) -> {{#lambda.camelcase}}{{name}}{{/lambda.camelcase}}.processRequest(ctx{{vendorExtensions.index}}, {{/vendorExtensions.isFirst}}{{#vendorExtensions.isLast}}chain, request{{vendorExtensions.index}}), {{/vendorExtensions.isLast}} {{/methods}}{{#methods}} {{^vendorExtensions.isFirst}}{{^vendorExtensions.isLast}}
                                    request{{vendorExtensions.revertIndex}}), {{/vendorExtensions.isLast}}{{/vendorExtensions.isFirst}} {{/methods}}
                    request);
    }
{{/vendorExtensions.authMethods}}
}
